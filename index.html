
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คำนวณพิกัดเสาเข็ม</title>
    <style>
        body { font-family: sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: flex-start; padding: 40px 20px; min-height: 100vh; }
        .container { background: white; padding: 24px; border-radius: 10px; max-width: 400px; width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { text-align: center; margin-bottom: 1rem; }
        label { display: block; margin-top: 12px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; }
        .results { background: #f9f9f9; padding: 16px; margin-top: 20px; border-radius: 6px; font-size: 16px; }
        a { display: block; margin-top: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>คำนวณพิกัดเสาเข็ม</h1>

        <label for="pileSelect">เลือก Pile No.</label>
        <select id="pileSelect" onchange="selectPile()">
            <option value="">-- เลือก --</option>
        </select>

        <label for="nActual">N (Actual)</label>
        <input type="number" id="nActual" step="any">

        <label for="eActual">E (Actual)</label>
        <input type="number" id="eActual" step="any">

        <label for="nDesign">N (Design)</label>
        <input type="number" id="nDesign" step="any">

        <label for="eDesign">E (Design)</label>
        <input type="number" id="eDesign" step="any">

        <div class="results" id="results">
            N Deviation: <span id="nDev">+0.000</span><br>
            E Deviation: <span id="eDev">+0.000</span><br>
            Pile Deviation: <span id="pileDev">0.000</span>
        </div>
        <a href="design-editor.html">→ แก้ไข Design</a>
    </div>

    <script>
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => input.addEventListener('input', calculateDeviation));

        function formatDeviation(value) {
            const formatted = value.toFixed(3);
            return value > 0 ? '+' + formatted : formatted;
        }

        function calculateDeviation() {
            const nActual = parseFloat(document.getElementById('nActual').value) || 0;
            const eActual = parseFloat(document.getElementById('eActual').value) || 0;
            const nDesign = parseFloat(document.getElementById('nDesign').value) || 0;
            const eDesign = parseFloat(document.getElementById('eDesign').value) || 0;

            const nDev = nActual - nDesign;
            const eDev = eActual - eDesign;
            const pileDev = Math.sqrt(nDev * nDev + eDev * eDev);

            document.getElementById('nDev').innerText = formatDeviation(nDev);
            document.getElementById('eDev').innerText = formatDeviation(eDev);
            document.getElementById('pileDev').innerText = pileDev.toFixed(3);
        }

        let designData = {};

        function selectPile() {
            const pileNo = document.getElementById('pileSelect').value;
            if (designData[pileNo]) {
                document.getElementById('nDesign').value = designData[pileNo].N;
                document.getElementById('eDesign').value = designData[pileNo].E;
                calculateDeviation();
            }
        }

        fetch('design.json')
            .then(response => response.json())
            .then(data => {
                designData = data;
                const select = document.getElementById('pileSelect');
                for (const pile in designData) {
                    const option = document.createElement('option');
                    option.value = pile;
                    option.textContent = pile;
                    select.appendChild(option);
                }
            });
    </script>
</body>
</html>
